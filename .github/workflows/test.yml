name: System Tests

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  validate-flake:
    name: Validate Flake Structure
    runs-on: self-hosted
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Validate flake.nix syntax
        run: |
          nix --version
          nix flake show --json > /dev/null
          
      - name: Check flake metadata
        run: nix flake metadata
        
      - name: List all outputs
        run: nix flake show

  eval-systems:
    name: Evaluate System Configurations
    runs-on: self-hosted
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Evaluate yoga configuration
        run: |
          nix eval .#nixosConfigurations.yoga.config.system.name
          nix eval .#nixosConfigurations.yoga.config.networking.hostName
          
      - name: Evaluate skyspy-dev configuration
        run: |
          nix eval .#nixosConfigurations.skyspy-dev.config.system.name
          nix eval .#nixosConfigurations.skyspy-dev.config.networking.hostName
