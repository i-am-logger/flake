name: Test Self-Hosted Runner

on:
  workflow_dispatch:

jobs:
  test-runner:
    name: Test Self-Hosted Runner
    runs-on:
      - flake

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: System information
        run: |
          echo "ğŸ–¥ï¸  Hostname: $(hostname)"
          echo "ğŸ§ OS: $(uname -a)"
          echo "ğŸ’¾ Disk space:"
          df -h
          echo ""
          echo "ğŸ§  Memory:"
          free -h

      - name: Check GPU availability
        run: |
          if command -v rocm-smi &> /dev/null; then
            echo "ğŸ® AMD GPU detected:"
            rocm-smi
          elif command -v nvidia-smi &> /dev/null; then
            echo "ğŸ® NVIDIA GPU detected:"
            nvidia-smi
          else
            echo "â„¹ï¸  No GPU tools found (rocm-smi or nvidia-smi)"
          fi

      - name: Docker availability
        run: |
          echo "ğŸ³ Docker version:"
          docker --version
          echo ""
          echo "ğŸ³ Docker info:"
          docker info

      - name: Container test
        run: |
          echo "ğŸ“¦ Testing container capabilities..."
          echo "Current working directory: $(pwd)"
          echo "User: $(whoami)"
          echo "Available shells: $(cat /etc/shells 2>/dev/null || echo 'N/A')"

      - name: Runner labels
        run: |
          echo "ğŸ·ï¸  This runner has the following labels:"
          echo "  - self-hosted"
          echo "  - host-$(hostname)"
          echo "  - repo-flake"

      - name: Success message
        run: |
          echo "âœ… Self-hosted runner test completed successfully!"
          echo "ğŸ‰ Runner is working properly on $(hostname)"
