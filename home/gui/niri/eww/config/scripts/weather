#!/usr/bin/env bash

# Weather - simplified from waybar python script for eww defpoll
# Outputs plain text: emoji + temperature

data=$(curl -sf "https://wttr.in/?format=j1" 2>/dev/null)

if [ -z "$data" ]; then
    echo "ó°…¤"
    exit 0
fi

code=$(echo "$data" | jq -r '.current_condition[0].weatherCode' 2>/dev/null)
feels_like=$(echo "$data" | jq -r '.current_condition[0].FeelsLikeF' 2>/dev/null)

# Map weather codes to emojis
case "$code" in
    113) icon="â˜€ï¸" ;;
    116) icon="â›…" ;;
    119|122) icon="â˜ï¸" ;;
    143|248|260) icon="ğŸŒ«" ;;
    176|263|266|293|296) icon="ğŸŒ¦" ;;
    179|182|185|281|284|299|302|305|308|311|314|317|350|353|356|359|362|365|374|377) icon="ğŸŒ§" ;;
    200|386|392) icon="â›ˆ" ;;
    389) icon="ğŸŒ©" ;;
    227|320|323|326|368) icon="ğŸŒ¨" ;;
    230|329|332|335|338|371|395) icon="â„ï¸" ;;
    *) icon="â˜ï¸" ;;
esac

echo "${icon} ${feels_like}Â°"
